#!/bin/sh

startDir=$HOME/work/devops
cd $startDir || exit 1

checkfile() {
	src=files/$1
	installed=$2/$1
	echo diff $src $installed
	diff $src $installed
}

cmd pwd
checkfile .bashrc			$HOME
checkfile .bash_aliases			$HOME
checkfile .cshrc			$HOME
checkfile authorized_keys		$HOME/.ssh
checkfile ../bin/hwinfo			$HOME/bin

if test `hostname` = ads.fywss.com; then
	cmd diff ../si/hosts.acuity		/etc/hosts
else
	checkfile hosts				/etc
fi

if test `uname` = Darwin; then
	cd darwin
	cmd pwd
	checkfile rc.local			$HOME/bin
	checkfile rc.local			/etc
	checkfile nginx.conf			/etc/nginx
	checkfile ssh_config			/etc/ssh
	checkfile sshd_config			/etc/ssh
	checkfile local.startup.plist		/Library/LaunchDaemons
	checkfile homebrew.mxcl.nomad.plist	/usr/local/Cellar/nomad/*
	checkfile homebrew.mxcl.consul.plist	/usr/local/Cellar/consul/*
	cmd sudo diff files/sudoers		/etc
	cd ../`shost` || exit 0
	set -x
	pwd
	diff nomad.hcl		/etc/nomad
	diff consul.hcl		/etc/consul
	diff telegraf.conf	/usr/local/etc
	exit 0
fi

checkfile services			/etc
checkfile rc.local			/etc

if test `uname -m` = armv7l; then
	checkfile sshd_config			/etc/ssh
	checkfile dhcpcd.conf			/etc
	checkfile resolv.conf			/etc
	cd $HOME/work/ops/replace && ./checkfiles;
	cd $startDir || exit 1
else
	checkfile nginx/fywss-proxies		/etc
	checkfile nginx/sites-enabled/default	/etc
fi

cd ./`shost` || exit 0
set -x
pwd
diff telegraf.conf	/etc/telegraf
diff sshd_config	/etc/ssh
diff nomad.hcl		/etc/nomad
diff consul.hcl		/etc/consul
