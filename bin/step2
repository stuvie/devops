#!/bin/sh

tools="prometheus prometheus-node-exporter grafana certbot apache2"
# un-comment the next line to get a few more tools (with lots of dependencies)
#tools="$tools icinga icinga-doc"

startdir=`pwd`
appdir=`basename $startdir`
bakdir=/bak/step1

usage() {
	echo usage: sudo ./bin/step && exit 1
}

if test `whoami` != root; then
	echo must be run as root
	usage
fi

if test $# -gt 0; then
	usage
fi

if test -d $bakdir; then
	echo error: $bakdir already exists && exit 2
fi

echo installing devops tools:
apt-get install -y $tools
cp files/prometheus.yml /etc/prometheus/prometheus.yml
systemctl enable prometheus
systemctl start prometheus

echo creating $bakdir
mkdir -p $bakdir
cp -a /etc $bakdir
touch /etc/LOCAL_changes_start

./bin/hwinfo > hwinfo-step2-`hostname`.txt
